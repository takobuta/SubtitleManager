# 🎬 Subtitle Parser App

**SRT 字幕のカット・時間調整・外字置換をワンストップで行える Windows フォームアプリ**です。  
動画編集時に生じる字幕のタイミングずれや、機種依存文字を簡単に整え、再利用しやすい `.srt` を再出力できます。

## 目次
- [概要](#概要)
- [主な機能](#主な機能)
- [技術スタック](#技術スタック)
- [前提条件](#前提条件)
- [クイックスタート](#クイックスタート)
- [セットアップと実行](#セットアップと実行)
- [設定・データファイル](#設定データファイル)
- [ディレクトリ構成](#ディレクトリ構成)
- [運用・開発のヒント](#運用開発のヒント)
- [トラブルシューティング](#トラブルシューティング)
- [ライセンスと貢献](#ライセンスと貢献)

## 概要
- SRT 字幕を読み込み、時間範囲を指定してカット、字幕の前倒し/後ろ倒し、外字置換などを行い、新しい SRT と付随情報を出力します。
- 未出力の編集が残っている場合は、終了時に警告して保存漏れを防ぎます。
- 解析中の例外はアプリ直下の `Logs` ディレクトリに自動保存され、原因調査が容易です。

## 主な機能
- **カット編集**（タブ「①カット（字幕編集）」）：指定時間帯の字幕を削除または終了時間調整し、カット情報を SRT に追記して出力。必要に応じて外字置換も同時実行。
- **カット情報出力のみ**（タブ「②カットのみ」）：動画ファイルの時間を基準にカット区間だけを登録・出力し、元動画換算の位置も併記。
- **時間調整**（タブ「③字幕調整」）：指定区間の字幕を一括で遅らせる/早める。調整内容を SRT に追記して出力。
- **外字置換のみ**（タブ「④外字置換」）：SRT を読み込み、外字置換ルールに従って新しいファイルを生成。
- **外字置換ルール管理**：`gaijiReplaceInfo.csv` に記述した「置換対象,置換後」ペアで一括変換。ファイルはビルド時に出力先へ自動コピー。

## 技術スタック
- 言語 / ランタイム: C# / .NET Framework 4.7.2（WinForms）
- IDE: Visual Studio 2019 以降（.NET Framework 4.7.2 Developer Pack が必要）
- 対応 OS: Windows 10 / 11

## 前提条件
- .NET Framework 4.7.2 Developer Pack がインストールされていること。
- Windows 環境で Visual Studio 2019 以降を利用できること。
- SRT ファイル、必要に応じて外字置換ルール CSV（`gaijiReplaceInfo.csv`）を用意すること。

## クイックスタート
1. リポジトリをクローンし、Visual Studio で `SubtitleManager.sln` を開く。
2. ソリューション構成を `Release` または `Debug` に設定し、ビルド（Ctrl+Shift+B）。
3. 実行（F5）または `bin/<構成>/SubtitleParserApp.exe` を起動。
4. アプリのタブに従って SRT を読み込み、カット・時間調整・外字置換を行い、出力ボタンで保存。

## セットアップと実行
```powershell
# リポジトリ取得
git clone <このリポジトリのURL>
cd SubtitleManager

# Visual Studio でソリューションを開き、ビルド & 実行
# （またはビルド済みの exe を直接起動）
```

### 各タブの使い方
- **①カット（字幕編集）**
  - 「字幕ファイル選択」で SRT を読み込み。
  - カット開始/終了を `hh:mm:ss.fff` 形式で入力し「カット編集」。
  - 「カット範囲内の字幕は削除する」の ON/OFF で挙動切替。
  - 「外字が含まれる場合は置換する」を ON にすると、指定 CSV に基づき置換して出力。
  - 「出力」で `<元ファイル名>_edit.srt` を生成し、カット情報と元動画換算のカット情報を追記。
- **②カットのみ**
  - 動画ファイル（`.ts`/`.mp4`）の時間を基準にカット区間を登録し、「出力」で `<元ファイル名>_cutInfot.txt` を作成。元動画換算の位置も併記。
- **③字幕調整**
  - SRT を読み込み、開始/終了範囲とオフセットを入力。
  - 「早める／遅らせる」を選択して「編集」で適用。
  - 「出力」で `<元ファイル名>_edit.srt` を生成し、調整情報を追記。
- **④外字置換**
  - SRT と外字置換 CSV を選択し、「出力」で `<元ファイル名>_replace.srt` を作成。

## 設定・データファイル
- `SubtitleParserApp/gaijiReplaceInfo.csv`
  - 1 行につき `置換対象,置換後` を記載。例: `[外:xxxx],株式会社`
  - プロジェクト設定で「常に出力先にコピー」されるため、ビルド後も同名パスで利用可能。
- `SubtitleParserApp/App.config`
  - `.NETFramework,Version=v4.7.2` を利用。
  - `CutInfoOutputPath` 設定項目あり（現時点では値未設定、必要に応じて拡張）。
- ログ出力: 実行ディレクトリ直下の `Logs/Log_yyyyMMdd_HHmmss.txt` に未処理例外を保存。

## ディレクトリ構成
```
SubtitleManager/
├─ SubtitleManager.sln           # ソリューション
├─ README.md                     # 本ドキュメント
└─ SubtitleParserApp/            # WinForms アプリ本体
   ├─ SubtitleParserApp.csproj   # プロジェクト設定
   ├─ Program.cs                 # エントリーポイントと例外ログ出力
   ├─ SubtitleParserForm.*       # フォーム UI とイベントロジック
   ├─ SubtitleService.cs         # SRT 解析・編集・外字置換ロジック
   ├─ gaijiReplaceInfo.csv       # 外字置換ルール（出力先へ自動コピー）
   └─ ほかモデル/設定ファイル
```

## 運用・開発のヒント
- **ビルド構成**: `Debug`/`Release` いずれも Any CPU。GUI フォントは「メイリオ」指定。
- **例外調査**: 予期せぬエラーは `Logs` フォルダを参照。
- **外字置換ルール拡張**: CSV に置換ペアを追記すれば即反映。未定義の外字が残る場合、出力に `[外:` が含まれるので検索して対応。
- **ソース拡張の入口**: 時間操作や置換ロジックは `SubtitleService` に集約。UI 操作は `SubtitleParserForm` に実装されているため、機能追加時は両方を確認するとスムーズ。

## トラブルシューティング
- **「Invalid time range.」が表示される**: 時刻の形式 `hh:mm:ss.fff` が正しいか、開始 < 終了かを確認してください。
- **外字置換が実行されない**: チェックボックスが ON か、CSV のパスが正しいかを確認。CSV の文字コードは UTF-8 を推奨。
- **出力が保存されないまま終了しそう**: 未出力の編集があるときは終了確認ダイアログが表示されます。必ず「出力」を実行してください。

## ライセンスと貢献
- 本リポジトリにライセンス表記はありません。（要確認）
- 改善提案や不具合報告は Issue / Pull Request で歓迎します。開発フローに明確な規約がないため、変更点の概要と目的を README に沿って共有してください。
